pacman::p_load(tmap,sf,sp,caret,stplanr, reshape2,broom, tidyverse)
adbus <- read_csv("data/aspatial/origin_destination_bus_202210.csv")
odbus <- read_csv("data/aspatial/origin_destination_bus_202210.csv")
odbus$ORIGIN_PT_CODE <-
as.factor(odbus$ORIGIN_PT_CODE)
odbus$DESTINATION_PT_CODE <-
as.factor(odbus$DESTINATION_PT_CODE)
odbus7_9 <- odbus %>%
filter(DAY_TYPE== "WEEKDAY") %>%
filter(TIME_PER_HOUR >=7 &
TIME_PER_HOUR <= 9 ) %>%
group_by(ORIGIN_PT_CODE,
DESTINATION_PT_CODE) %>%
summaries(TRIPS = sum(TOTAL_TRIPS))
odbus7_9 <- odbus %>%
filter(DAY_TYPE== "WEEKDAY") %>%
filter(TIME_PER_HOUR >=7 &
TIME_PER_HOUR <= 9 ) %>%
group_by(ORIGIN_PT_CODE,
DESTINATION_PT_CODE) %>%
summarisE(TRIPS = sum(TOTAL_TRIPS))
odbus7_9 <- odbus %>%
filter(DAY_TYPE== "WEEKDAY") %>%
filter(TIME_PER_HOUR >=7 &
TIME_PER_HOUR <= 9 ) %>%
group_by(ORIGIN_PT_CODE,
DESTINATION_PT_CODE) %>%
summarise(TRIPS = sum(TOTAL_TRIPS))
View(odbus7_9)
write_rds(odbus7_9, "data/rds/odbus7_9.rds")
odbus7_9 <- read_rds("data/rds/adbus7_9.rds ")
odbus7_9 <- read_rds("data/rds/odbus7_9.rds ")
busstop <- st_read(dsn="data/aspatial", layer="BusStop") %>%
st_transform(crs=3414)
busstop <- st_read(dsn="data/geospatial", layer="BusStop") %>%
st_transform(crs=3414)
mpsz <- st_read(dsn="data/geospatial", layer="MPSZ-2019") %>%
st_transform(crs = 3414)
busstop_mpsz <- st_intersection(busstop, mpsz)%>%
select(BUS_STOP_N, subzone_c) %>%
st-drop_geometry()
busstop_mpsz <- st_intersection(busstop, mpsz)%>%
select(BUS_STOP_N, subzone_c) %>%
st_drop_geometry()
busstop_mpsz <- st_intersection(busstop, mpsz)%>%
select(BUS_STOP_N, SUBZONE_C)%>%
st_drop_geometry()
View(busstop_mpsz)
od_data <- left_join(odbus7_9, busstop_mpsz,
by = c("ORIGIN_PT_CODE" = "BUS_STOP_N")) %>%
rename(ORIGIN_BS = ORIGIN_PT_CODE,
ORIGIN_SZ = SUBZONE_C.
DESTIN_BS = DESTINATION_PT_CODE)
od_data <- left_join(odbus7_9, busstop_mpsz,
by = c("ORIGIN_PT_CODE" = "BUS_STOP_N")) %>%
rename(ORIGIN_BS = ORIGIN_PT_CODE,
ORIGIN_SZ = SUBZONE_C,
DESTIN_BS = DESTINATION_PT_CODE)
View(od_data)
dupliate <- od_data %>%
group_by_all() %>%
filter(n()>1) %>%
ungroup()
duplicate <- od_data %>%
group_by_all() %>%
filter(n()>1) %>%
ungroup()
ad_data <- unique(od_data)
od_data <- unique(od_data)
od_data <- left_join(od_data, busstop_mpsz,
by = c("DESTIN_BS" = "BUS_STOP_N"))
duplicate <- od_data %>%
group_by_all() %>%
filter(n()>1) %>%
ungroup()
od_data <- unique(od_data)
duplicate <- od_data %>%
group_by_all() %>%
filter(n()>1) %>%
ungroup()
od_data <- od_data %>%
rename(DESTIN_SC = SUBZONE_C) %>%
drop_na()
View(od_data)
write_rds(od_data,"data/rds/od_data.rds")
od_data <- read_rds("data/rds/od_data.rds")
mpsz_sp <- as(mpsz, "Spatial")
dist <- spDists(mpsz_sp)
dist <- spDists(mpsz_sp)
dist
sz_names <- mpsz$SUBZONE_C
colnames(dist) <- paste0(sz_names)
rownames(dist) <- paste0(sz_names)
distpair <- melt(dist) %>%
rename(dist = value)
head(distpair,10)
distpair$dist <- ifelse(distpair$dist == 0,
50, distpair$dist)
distpair <- distpair %>%
rename(orig = Var1,
dest = Var2)
flow_data <- od_data %>%
group_by(ORIGIN_SZ, DESTIN_SZ) %>%
summarise(TRIPS = sum(TRIPS))
View(od_data)
flow_data <- od_data %>%
group_by(ORIGIN_SZ, DESTIN_SC) %>%
summarise(TRIPS = sum(TRIPS))
View(flow_data)
pop <- read_csv("data/aspatial/pop.csv")
pop <- pop %>%
left_join(mpsz,
by= c("PA" = "PLN_AREA_N",
"SZ" = "SUBZONE_N")) %>%
select(1:6) %>%
rename(SZ_NAME = SZ,
SZ = SUBZONE_C)
flow_data <- flow_data %>%
left_join(distpair,
by = c("ORIGIN_SZ" = "orig",
"DESTIN_SC" = "dist"))
flow_data <- flow_data %>%
left_join (distpair,
by = c("ORIGIN_SZ" = "orig",
"DESTIN_SC" = "dest"))
flow_data1 <- flow_data1 %.%
left_join(pop,
by = c(ORIGIN_SZ = "SZ"))%>%
rename(ORIGIN_AGE7_12 = AGE7_12,
ORIGIN_AGE13_24 = AGE13_24,
ORIGIN_AGE25_64 = AGE25_64) %>%
select(-c(PA,SZ_NAME))
flow_data1 <- flow_data1 %>%
left_join(pop,
by = c(ORIGIN_SZ = "SZ"))%>%
rename(ORIGIN_AGE7_12 = AGE7_12,
ORIGIN_AGE13_24 = AGE13_24,
ORIGIN_AGE25_64 = AGE25_64) %>%
select(-c(PA,SZ_NAME))
flow_data1 <- flow_data %>%
left_join(pop,
by = c(ORIGIN_SZ = "SZ"))%>%
rename(ORIGIN_AGE7_12 = AGE7_12,
ORIGIN_AGE13_24 = AGE13_24,
ORIGIN_AGE25_64 = AGE25_64) %>%
select(-c(PA,SZ_NAME))
View(flow_data1)
