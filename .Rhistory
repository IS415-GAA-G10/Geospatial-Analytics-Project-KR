end = 100,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
pacman::p_load(sf, readr, tidyverse, tmap)
seoul <- st_read(dsn = "data_final/seoul_adm2",
layer= "seoul_adm2") %>%
st_transform(crs = 5179)
clinics <- st_read(dsn = "data_final/seoul_clinics",
layer = "seoul_clinics") %>%
st_transform(crs = 5179)
hospitals <- st_read(dsn = "data_final/seoul_hospitals",
layer = "seoul_hospitals") %>%
st_transform(crs = 5179)
residence <- st_read(dsn = "data_final/seoul_residential",
layer = "seoul_residential") %>%
st_transform(crs = 5179)
road <- st_read(dsn="data_final/seoul_roads",
layer = "seoul_roads_v2")%>%
st_transform(crs = 5179)
clinic <- clinics %>%
select(1,3)
hospitals <- hospitals %>%
select(1,3)
residence <- residence %>%
select(1,3)
road <- road %>%
select(1,3)
population <- read_csv("data_final/population_seoul.csv")
pop <- population %>%
select(1,2) %>%
mutate(Elderly_pop = round(0.1758*`Total population (Person)`,0)) %>%
rename(name_en =`By administrative divisions(eup, myeon, dong)`)
Ihwa <- seoul %>%
filter(name_en == "Ihwa-dong") %>%
select(name_en)
pacman::p_load(sf, spNetwork)
R <- st_intersection(road, Ihwa)
H <- st_intersection(hospitals, Ihwa)
RE <- st_intersection(residence, Ihwa)
H_P <- st_centroid(H)
RE_P <- st_centroid(RE)
if ("MULTILINESTRING" %in% st_geometry_type(R)){
converted <- st_cast(R[which(st_geometry_type(R) == "MULTILINESTRING"),], "LINESTRING")
linestring <- R[which(st_geometry_type(R) == "LINESTRING"),]
roads_by_gu_new<- rbind(linestring, converted)
}
roads_by_gwanak <- roads_by_gu_new %>%
filter(name_en == "Gwanak-gu")
hospital_by_gwanak <- hospital_by_gu %>%
filter(name_en == "Gwanak-gu")
# Filter out only LINESTRING geometries
lixels <- lixelize_lines(roads_by_gu_new, 700, mindist = 350)
samples <- lines_center(lixels)
hospital_by_gwanak_sp <- as_Spatial(H_P)
densities <- nkde(roads_by_gu_new,
events = H_P,
w = rep(1,nrow(H_P)),
samples = samples,
kernel_name = "quartic",
bw = 300,
div= "bw",
adaptive = FALSE,
method = "continuous",
digits = 1,
tol = 1,
grid_shape = c(1,1),
max_depth = 8,
agg = 20, #we aggregate events within a 5m radius (faster calculation)
sparse = TRUE,
verbose = FALSE)
samples$density <- densities/1000
lixels$density <- densities/1000
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 100,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plot
View(kfun_hospital)
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 100,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 5,
conf_int = 0.05)
kfun_hospital$plot
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 100,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
conf_int = 0.05)
kfun_hospital$plot
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density")
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 100,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
conf_int = 0.05)
kfun_hospital$plot
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 30,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
conf_int = 0.05)
kfun_hospital$plot
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 30,
step = 1,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 900000,
step = 100,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 1000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
seoul <- st_read(dsn = "data_final/seoul_adm2",
layer= "seoul_adm2") %>%
st_transform(crs = 5179)
clinics <- st_read(dsn = "data_final/seoul_clinics",
layer = "seoul_clinics") %>%
st_transform(crs = 5179)
hospitals <- st_read(dsn = "data_final/seoul_hospitals",
layer = "seoul_hospitals") %>%
st_transform(crs = 5179)
residence <- st_read(dsn = "data_final/seoul_residential",
layer = "seoul_residential") %>%
st_transform(crs = 5179)
road <- st_read(dsn="data_final/seoul_roads",
layer = "seoul_roads_v2")%>%
st_transform(crs = 5179)
clinic <- clinics %>%
select(1,3)
hospitals <- hospitals %>%
select(1,3)
residence <- residence %>%
select(1,3)
road <- road %>%
select(1,3)
Ihwa <- seoul %>%
filter(name_en == "Yongsin-dong") %>%
select(name_en)
pacman::p_load(sf, spNetwork)
R <- st_intersection(road, Ihwa)
H <- st_intersection(hospitals, Ihwa)
RE <- st_intersection(residence, Ihwa)
H_P <- st_centroid(H)
RE_P <- st_centroid(RE)
if ("MULTILINESTRING" %in% st_geometry_type(R)){
converted <- st_cast(R[which(st_geometry_type(R) == "MULTILINESTRING"),], "LINESTRING")
linestring <- R[which(st_geometry_type(R) == "LINESTRING"),]
roads_by_gu_new<- rbind(linestring, converted)
}
# Filter out only LINESTRING geometries
lixels <- lixelize_lines(roads_by_gu_new, 700, mindist = 350)
samples <- lines_center(lixels)
hospital_by_gwanak_sp <- as_Spatial(H_P)
densities <- nkde(roads_by_gu_new,
events = H_P,
w = rep(1,nrow(H_P)),
samples = samples,
kernel_name = "quartic",
bw = 300,
div= "bw",
adaptive = FALSE,
method = "continuous",
digits = 1,
tol = 1,
grid_shape = c(1,1),
max_depth = 8,
agg = 20, #we aggregate events within a 5m radius (faster calculation)
sparse = TRUE,
verbose = FALSE)
samples$density <- densities/1000
lixels$density <- densities/1000
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density")
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 1000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
?spNetwork::gfunc_cpp()
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 1000, step = 50, width = 50, nsim = 50, conf_int = 0.05)
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 15, step = 0.5, width = 50, nsim = 50, conf_int = 0.05)
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 10,
step = 0.5,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 10000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 50000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 10000, step = 50, width = 50, nsim = 50, conf_int = 0.05)
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 2500, step = 50, width = 50, nsim = 50, conf_int = 0.05)
qtm(H_P)
qtm(H)
qtm(hospitals)
Ihwa <- seoul %>%
filter(name_en == "Gangnam-gu") %>%
select(name_en)
pacman::p_load(sf, spNetwork)
R <- st_intersection(road, Ihwa)
H <- st_intersection(hospitals, Ihwa)
RE <- st_intersection(residence, Ihwa)
H_P <- st_centroid(H)
RE_P <- st_centroid(RE)
if ("MULTILINESTRING" %in% st_geometry_type(R)){
converted <- st_cast(R[which(st_geometry_type(R) == "MULTILINESTRING"),], "LINESTRING")
linestring <- R[which(st_geometry_type(R) == "LINESTRING"),]
roads_by_gu_new<- rbind(linestring, converted)
}
roads_by_gwanak <- roads_by_gu_new %>%
filter(name_en == "Gwanak-gu")
hospital_by_gwanak <- hospital_by_gu %>%
filter(name_en == "Gwanak-gu")
# Filter out only LINESTRING geometries
lixels <- lixelize_lines(roads_by_gu_new, 700, mindist = 350)
samples <- lines_center(lixels)
hospital_by_gwanak_sp <- as_Spatial(H_P)
densities <- nkde(roads_by_gu_new,
events = H_P,
w = rep(1,nrow(H_P)),
samples = samples,
kernel_name = "quartic",
bw = 300,
div= "bw",
adaptive = FALSE,
method = "continuous",
digits = 1,
tol = 1,
grid_shape = c(1,1),
max_depth = 8,
agg = 20, #we aggregate events within a 5m radius (faster calculation)
sparse = TRUE,
verbose = FALSE)
samples$density <- densities*1000
lixels$density <- densities*1000
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density")
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 50000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 1000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
kfun_hospital <- kfunctions(roads_by_gu_new,
H_P,
start = 0,
end = 10000,
step = 50,
width = 50,
nsim = 50,
resolution = 50,
verbose = FALSE,
digits = 10,
conf_int = 0.05)
kfun_hospital$plotk
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 2500, step = 50, width = 50, nsim = 50, conf_int = 0.05)
kfun_hospital$plotk
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="-density")
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density")
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
pallete = "Blues")
tm_shape()
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
palette = "Blues")
tm_shape(H_P) +
tm_dots(col = "red")
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
palette = "Blues") +
tm_shape(H_P) +
tm_dots(col = "red")
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
palette = "Blues") +
tm_shape(H_P) +
tm_dots(col = "red",
size =0.1)
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
palette = "Reds") +
tm_shape(H_P) +
tm_dots(col = "blue",
size =0.01)
shiny::runApp('Test')
pacman::p_load(sf, readr, tidyverse, tmap)
seoul <- st_read(dsn = "data_final/seoul_adm2",
layer= "seoul_adm2") %>%
st_transform(crs = 5179)
clinics <- st_read(dsn = "data_final/seoul_clinics",
layer = "seoul_clinics") %>%
st_transform(crs = 5179)
hospitals <- st_read(dsn = "data_final/seoul_hospitals",
layer = "seoul_hospitals") %>%
st_transform(crs = 5179)
residence <- st_read(dsn = "data_final/seoul_residential",
layer = "seoul_residential") %>%
st_transform(crs = 5179)
road <- st_read(dsn="data_final/seoul_roads",
layer = "seoul_roads_v2")%>%
st_transform(crs = 5179)
clinic <- clinics %>%
select(1,3)
hospitals <- hospitals %>%
select(1,3)
residence <- residence %>%
select(1,3)
road <- road %>%
select(1,3)
Ihwa <- seoul %>%
filter(name_en == "Gangnam-gu") %>%
select(name_en)
pacman::p_load(sf, spNetwork)
R <- st_intersection(road, Ihwa)
H <- st_intersection(hospitals, Ihwa)
RE <- st_intersection(residence, Ihwa)
H_P <- st_centroid(H)
RE_P <- st_centroid(RE)
if ("MULTILINESTRING" %in% st_geometry_type(R)){
converted <- st_cast(R[which(st_geometry_type(R) == "MULTILINESTRING"),], "LINESTRING")
linestring <- R[which(st_geometry_type(R) == "LINESTRING"),]
roads_by_gu_new<- rbind(linestring, converted)
}
# Filter out only LINESTRING geometries
lixels <- lixelize_lines(roads_by_gu_new, 700, mindist = 350)
hospital_by_gwanak_sp <- as_Spatial(H_P)
samples <- lines_center(lixels)
densities <- nkde(roads_by_gu_new,
events = H_P,
w = rep(1,nrow(H_P)),
samples = samples,
kernel_name = "quartic",
bw = 300,
div= "bw",
adaptive = FALSE,
method = "continuous",
digits = 1,
tol = 1,
grid_shape = c(1,1),
max_depth = 8,
agg = 20, #we aggregate events within a 5m radius (faster calculation)
sparse = TRUE,
verbose = FALSE)
samples$density <- densities*1000
lixels$density <- densities*1000
tmap_mode('view')
tm_shape(lixels)+
tm_lines(col="density",
palette = "Reds") +
tm_shape(H_P) +
tm_dots(col = "blue",
size =0.01)
cross_kfunctions(roads_by_gu_new, RE_P, H_P, start= 0, end = 2500, step = 50, width = 50, nsim = 50, conf_int = 0.05)
cross_kfunctions(roads_by_gu_new,
RE_P,
H_P,
start= 0,
end = 2500,
step = 50,
width = 50,
nsim = 50,
agg = 50,
conf_int = 0.05)
cross_kfunctions(roads_by_gu_new,
RE_P,
H_P,
start= 0,
end = 2500,
step = 50,
width = 50,
nsim = 50,
agg = 100,
conf_int = 0.05)
crossfun_hospital<- cross_kfunctions(roads_by_gu_new,
RE_P,
H_P,
start= 0,
end = 2500,
step = 50,
width = 50,
nsim = 50,
agg = 100,
conf_int = 0.05)
crossfun_hospital$plotk
